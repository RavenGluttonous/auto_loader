# AutoLoader

AutoLoader是一个专为铜陵市人民医院开发的医疗流程自动化工具，通过扫描患者标识码获取信息并自动填入医疗检查软件，减少人工录入错误，提高工作效率。

## Windows用户快速指南（适用于非开发人员）

### 一键安装和构建

1. 下载此项目：
   - 点击页面上方绿色的"Code"按钮
   - 选择"Download ZIP"
   - 解压下载的ZIP文件到任意位置

2. 运行自动安装脚本：
   - 双击解压后文件夹中的`setup_and_build.bat`文件
   - 脚本将自动完成以下步骤：
     - 下载Oracle客户端
     - 安装所需的Python依赖
     - 构建可执行文件

3. 运行程序：
   - 构建完成后，可执行文件将位于`dist`目录中
   - 双击`auto_loader.exe`运行程序

### 注意事项

- 首次运行脚本需要下载约300MB的Oracle客户端，请确保网络连接稳定
- 如果下载Oracle客户端失败，脚本会提示手动下载方法
- 整个过程可能需要5-10分钟，取决于您的网络和计算机速度
- 如遇问题，请查看`logs`目录中的日志文件

## 系统要求

- Windows 10或更高版本
- Python 3.8或更高版本
- 二维码/条形码扫描器（串口连接）
- 网络连接（用于访问医院信息系统）

## 安装说明

1. 确保已安装Python 3.8或更高版本
2. 运行`install_dependencies.bat`安装所有必要的依赖项
3. 根据实际情况修改`config.py`中的配置：
   - 串口设置（扫描器）
   - 数据库连接参数
   - 其他系统配置

## 使用方法

1. 运行`auto_loader.py`启动程序：
   ```
   python auto_loader.py
   ```
2. 系统会在系统托盘显示AutoLoader图标
3. 使用扫描器扫描患者的二维码/条形码
4. 系统会自动从医院信息系统或体检系统获取患者信息
5. 信息会自动填入相应的医疗检查软件

## 开发环境设置

如果您在macOS或Linux等非Windows环境进行开发：

1. 安装所有依赖：`pip install -r requirements.txt`
2. 使用开发模式版本运行程序：
   ```
   python auto_loader_dev.py
   ```

**开发版本特点：**
- 不需要Tkinter、串口设备或其他Windows特定组件
- 使用控制台输入模拟扫描器输入
- 在控制台显示界面交互而不是实际操作界面
- 自动使用模拟数据代替实际API调用
- 数据库连接失败时自动使用模拟数据

**优化数据库连接：**
如果您在开发环境中遇到数据库连接超时问题，可以：
1. 使用 `config_dev.py` 替代 `config.py`（已自动尝试导入）
2. 在 `config_dev.py` 中设置 `POSTGRES_HOST = "127.0.0.1"` 使连接快速失败
3. 确保 `DEV_MODE = True` 以启用短连接超时

**通过VPN连接到医院数据库：**
如需通过VPN连接到实际的医院数据库进行开发测试：
1. 安装并配置VPN客户端（联系医院IT部门获取VPN访问权限）
2. 连接到医院VPN网络
3. 修改 `config_dev.py` 中的 `VPN_MODE = True`
4. 运行开发版本程序：`python auto_loader_dev.py`

**注意事项：**
- VPN模式下连接超时设置为10秒，可根据网络情况适当调整
- 如连接失败，请检查VPN连接是否正常，或切换回普通开发模式

**在开发版本中测试：**
1. 输入`TJ12345`等体检号码模拟体检系统流程
2. 输入其他字符串模拟医院HIS系统流程
3. 输入`AutoLoaderRollback`测试编号回退功能
4. 输入`exit`退出程序

## 构建可执行文件

在Windows环境中运行以下命令构建独立的可执行文件：

```
powershell -ExecutionPolicy Bypass -File build_exe.ps1
```

生成的可执行文件将位于`dist`目录中。

## 特殊功能

- 自动编号：系统会为每个样本自动生成编号
- 编号回退：扫描特定二维码"AutoLoaderRollback"可将样本编号减少1

## 故障排除

1. 如果扫描器无法连接，请检查`config.py`中的串口设置是否正确
2. 如果数据库连接失败，请确认网络连接和数据库配置
3. 如果自动输入过程中出错，确保鼠标光标不要移动到屏幕四角

## 注意事项

使用本软件期间，建议不要操作扫描过程中的计算机，以免干扰自动化进程。